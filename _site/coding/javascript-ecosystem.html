<!DOCTYPE html>
<html>

    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>A better javascript ecosystem - Coding</title>
    <meta name="description" content="  NOTE: THIS IS A DRAFT">

    <link rel="stylesheet" href="/css/main.css">
    <link rel="canonical" href="http://gelatindesign.co.uk/coding/javascript-ecosystem">
    <link rel="alternate" type="application/rss+xml" title="gelatindesign" href="http://gelatindesign.co.uk/feed.xml">

    <link rel="icon" type="image/png" href="/favicon.png">
</head>


    <body>

        <header class="site-header">

</header>

        <div class="page-content">
            <div class="wrapper">
                <div class="post">

    <header class="post-header">
        <a href="/" class="post-title-icon"><img src="/images/logo.png"></a>
        <h1 class="post-title">A Better <strong>Javascript Ecosystem</strong></h1>
        <p class="post-meta">29 June, 2018</p>
        <p class="post-meta post-categories">
            <a href="/coding/">coding</a>
            
                • wool
            
                • javascript
            
        </p>
    </header>

    <article class="post-content">
        <blockquote>
  <p><strong>NOTE: THIS IS A DRAFT</strong></p>
</blockquote>

<h3 id="why">Why?</h3>

<p><a href="https://www.npmjs.com/">NPM</a> is wonderful, and the huge volume of packages it has enabled has been a tremendous boon to the world of javascript development. It has formed the backbone of the growth in this sector.</p>

<p>However, I feel it has some deep rooted flaws that can not be brushed over with tools or considered approaches.</p>

<p>To this end, here I am proposing a new ecosystem built upon tools and architecture that present solutions to the primary flaws of NPM.</p>

<h3 id="goals">Goals</h3>

<h4 id="reduce-bloat-dependency-quantity-and-size-escalation">Reduce bloat, dependency quantity and size escalation</h4>

<p>With bundling and tree shaking not everything in your <code class="highlighter-rouge">node_modules</code> ends up in the data sent to the user’s browser, but having several hundred megabytes of dependencies is still a significant problem for developers.</p>

<p>A package can be installed multiple times at different versions, and the cost of adding one package is relatively opaque with the sprawling tree of secondary dependencies it adds.</p>

<p>Even just presenting that information upfront will encourage developers to pay attention and naturally reduce the quantity of dependencies and size of their packages.</p>

<p>And by caching each package in your home directory, each version is truly only installed once on your local machine.</p>

<blockquote>
  <p><strong>Aside:</strong> This is possible with <a href="https://nodejs.org/api/esm.html#esm_loader_hooks">esm loader hooks</a>.</p>
</blockquote>

<h4 id="improve-stability-when-upgrading-dependencies">Improve stability when upgrading dependencies</h4>

<p>In theory, semantic versioning is supposed to protect you from upgrading a dependency to an incompatible version.</p>

<p>However, in practice, since the version of every NPM package is manually entered it still leaves a lot up to human interpretation.</p>

<p>So when you update dependencies to the latest versions within your existing constraints things can break unexpectedly. Particularly with large projects and several layers to the dependency tree.</p>

<p>Due to the nature of javascript it is impossible to eliminate this entirely, but it would not be hard to bake in automatic versioning support for at least the most clear-cut cases. Especially for typescript projects.</p>

<h4 id="namespaces-for-all">Namespaces for all</h4>

<p>Having mandatory namespaces for all published packages lets developers know who they are depending on.</p>

<p>It lets groups be formed that focus on <a href="https://thephpleague.com/">maintaining high quality packages</a>.</p>

<p>And reduces the need for ever creative package names, so they can be more descriptive and clear.</p>

<h4 id="naturally-deprecate-stale-and-unsupported-packages">Naturally deprecate stale and unsupported packages</h4>

<p>By forcing packages to declare all their dependencies upfront, it will naturally encourage maintained packages to rise and stale packages to fall in usage.</p>

<p>Packages will become stale if they are not updated in line with new releases of node and other packages they use.</p>

<p>If a package you are using does become stale and there is no-one left to maintain it, you can fork it under your namespace and start maintaining it yourself.</p>

<p>Stale packages are a hidden problem on NPM, it is often difficult to tell if it simply does not require any updates or if it is no longer viable and will cause bugs. A combination of upfront dependencies, enforced node version compatibility and namespaces will help alleviate this issue.</p>

<blockquote>
  <p><strong>Aside:</strong> This is something <a href="http://elm-lang.org">Elm</a> does, and I’ve yet to see any major complaints about dependency hell so… ¯\<em>(ツ)</em>/¯ should be fine.</p>
</blockquote>

<h4 id="enable-a-flexible-architecture-for-large-scale-projects">Enable a flexible architecture for large scale projects</h4>

<p><a href="https://lernajs.io/">Lerna</a> is cool. <a href="https://yarnpkg.com/lang/en/docs/workspaces/">Yarn workspaces</a> are cool. But they are both fairly rigid and limited in scope.</p>

<p>Imagine being able to have a true monorepo for all the packages within your purview at your job, yet also able to version packages independently and/or shared, in any grouping.</p>

<p>With all installed dependencies installed in your home directory there would be no need for hoisting and so resolves the often nightmarish issues that causes.</p>

<h4 id="decentralise-registries-for-package-hosting">Decentralise registries for package hosting</h4>

<p>Development ecosystems should be decentralised to help prevent monopolies and improve community agility, while empowering teams to work in the best way for their situation.</p>

<p>The ecosystem should allow developers to install from and publish to multiple registries, including their own, even an entirely local registry running on their machine.</p>

<h4 id="support-businesses-using-on-premise-registries">Support businesses using on premise registries</h4>

<p>A package registry should be free and open source to allow small businesses to benefit from the ability to host internal private packages.</p>

<p>It should be as simple as initialising a new registry, configuring a handful of parameters and running start.</p>

<h3 id="proposal">Proposal</h3>

<p>Below there are three sections:</p>

<ol>
  <li><a href="#package-manager">Package Manager</a></li>
  <li><a href="#registries">Registries</a></li>
  <li><a href="#further">Taking it Further</a></li>
</ol>

<p>The ideas presented are based on my experience, what I like and dislike about various package managers across several languages and where I think they can be a bit more ambitious.</p>

<p>If you have any ideas or feedback, supportive or critical, please send me a tweet <a href="https://twitter.com/lsjroberts">@lsjroberts</a> and I’d be more than happy to listen (and a little excited you read it to be honest).</p>

<blockquote>
  <p><strong>Note</strong></p>

  <p>For the purposes of the proposal I have called the package manager wool, because yarn… wool… haha so funny right.</p>

  <p>The name is not so relevant and likely to change.</p>
</blockquote>

<blockquote>
  <p><strong>Also note</strong></p>

  <p>These are just ideas I am spouting into the wind, none of it exists yet outside small experiments. It is all open to change based on feedback, feasibility and other issues.</p>
</blockquote>

<blockquote>
  <p><strong>Also also note</strong></p>

  <p>I do not intend this to be an attack on NPM or anything else, and I am genuinely grateful to all the work put into it, since I use it every day. This is just some opining.</p>
</blockquote>

<h2 id="package-manager" class="part-header">
    Part One
    <strong>Package Manager</strong>
</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wool init
</code></pre></div></div>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// wool.json</span>
<span class="p">{</span>
  <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"lsjroberts/example"</span><span class="p">,</span>
  <span class="s2">"version"</span><span class="p">:</span> <span class="s2">"1.0.0"</span><span class="p">,</span>
  <span class="s2">"registries"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"https://registry.wooljs.org"</span><span class="p">],</span>
  <span class="s2">"nodeVersion"</span><span class="p">:</span> <span class="s2">"10.5.0 &lt;= v &lt; 11.0.0"</span><span class="p">,</span>
  <span class="s2">"entry"</span><span class="p">:</span> <span class="s2">"index.mjs"</span><span class="p">,</span>
  <span class="s2">"dependencies"</span><span class="p">:</span> <span class="p">{}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="adding-dependencies">Adding dependencies</h3>

<p>A package manager should be clear and explicit about what it is doing. If I install a dependency I want to know just how much extra it is going to grow my project.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wool add lsjroberts/other
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>To add lsjroberts/other I would like to install the following dependencies:

    lsjroberts/other  1.0.0 &lt;= v &lt; 2.0.0
    bob/package       3.4.0 &lt;= v &lt; 3.5.0
    alice/package     2.2.0 &lt;= v &lt; 3.0.0

Adding a total of 87.9kb to your dependencies

May I install these for you? [Y/n]
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Installed 3 packages.

Your dependencies now total 87.9kb in size.
</code></pre></div></div>

<p>It should list all installed dependencies upfront.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// wool.json</span>
<span class="p">{</span>
  <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"lsjroberts/example"</span><span class="p">,</span>
  <span class="s2">"version"</span><span class="p">:</span> <span class="s2">"1.0.0"</span><span class="p">,</span>
  <span class="s2">"registries"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"https://registry.wooljs.org"</span><span class="p">],</span>
  <span class="s2">"nodeVersion"</span><span class="p">:</span> <span class="s2">"10.5.0 &lt;= v &lt; 11.0.0"</span><span class="p">,</span>
  <span class="s2">"dependencies"</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">"alice/package"</span><span class="p">:</span> <span class="s2">"2.2.0 &lt;= v &lt; 3.0.0"</span><span class="p">,</span>
    <span class="s2">"bob/package"</span><span class="p">:</span> <span class="s2">"3.4.0 &lt;= v &lt; 3.5.0"</span><span class="p">,</span>
    <span class="s2">"lsjroberts/other"</span><span class="p">:</span> <span class="s2">"1.0.0 &lt;= v &lt; 2.0.0"</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>And maintain a record of the exact versions installed.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// wool-lock.json</span>
<span class="p">{</span>
  <span class="s2">"alice/package"</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">"version"</span><span class="p">:</span> <span class="s2">"2.2.3"</span><span class="p">,</span>
    <span class="s2">"range"</span><span class="p">:</span> <span class="s2">"2.2.0 &lt;= v &lt; 3.0.0"</span><span class="p">,</span>
    <span class="s2">"registry"</span><span class="p">:</span> <span class="s2">"https://registry.wooljs.org"</span>
  <span class="p">},</span>
  <span class="s2">"bob/package"</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">"version"</span><span class="p">:</span> <span class="s2">"3.4.0"</span><span class="p">,</span>
    <span class="s2">"range"</span><span class="p">:</span> <span class="s2">"3.4.0 &lt;= v &lt; 3.5.0"</span><span class="p">,</span>
    <span class="s2">"registry"</span><span class="p">:</span> <span class="s2">"https://registry.wooljs.org"</span>
  <span class="p">},</span>
  <span class="s2">"lsjroberts/other"</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">"version"</span><span class="p">:</span> <span class="s2">"1.0.13"</span><span class="p">,</span>
    <span class="s2">"range"</span><span class="p">:</span> <span class="s2">"1.0.0 &lt;= v &lt; 2.0.0"</span><span class="p">,</span>
    <span class="s2">"registry"</span><span class="p">:</span> <span class="s2">"https://registry.wooljs.org"</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<blockquote>
  <p><strong>Note</strong>:</p>

  <p>Other potential methods include: removing the <code class="highlighter-rouge">wool-lock.json</code> and having the full dependency specification in <code class="highlighter-rouge">wool.json</code>, only putting directly added packages in <code class="highlighter-rouge">wool.json</code> and moving secondary dependencies into <code class="highlighter-rouge">wool-lock.json</code>.</p>
</blockquote>

<h3 id="automated-adding">Automated adding</h3>

<p>It should detect missing dependencies in my code and install them for me.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">missing</span> <span class="k">from</span> <span class="s1">'lsjroberts/missing'</span><span class="p">;</span>
<span class="nx">missing</span><span class="p">();</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>It looks like lsjroberts/missing has not been installed, should I add this for you? [Y/n]
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>To add lsjroberts/missing I would like to install the following dependencies:

    lsjroberts/missing  1.0.0 &lt;= v &lt; 2.0.0

Adding a total of 12.1kb to your dependencies

May I install these for you? [Y/n]
</code></pre></div></div>

<h3 id="offline-first">Offline first</h3>

<p>It should cache the dependencies on my machine to allow offline development.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~/.wool/
├─ packages/
│  ├─ alice/
│  │  └─ package/
│  │     ├─ 2.2.0/
│  │     └─ 2.2.3/
...
</code></pre></div></div>

<h3 id="conflicting-dependency-versions">Conflicting dependency versions</h3>

<p>It should protect me from conflicting packages.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wool add bob/conflicting
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>To add bob/conflicting I would like to install the following dependencies:

    bob/conflicting  3.0.0 &lt;= v &lt; 4.0.0
    bob/package      2.0.0 &lt;= v &lt; 3.0.0

However this would conflict with your current dependencies:

    bob/package  3.4.0 &lt;= v &lt; 3.5.0

Therefore I am unable to install bob/conflicting safely.

If I install this you will no longer be able to publish this package to https://registry.wooljs.org.

Should I go ahead and install it? [Y/n]
</code></pre></div></div>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// wool.json</span>
<span class="p">{</span>
  <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"lsjroberts/example"</span><span class="p">,</span>
  <span class="c1">// ...</span>
  <span class="s2">"dependencies"</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">"alice/package"</span><span class="p">:</span> <span class="s2">"2.2.0 &lt;= v &lt; 3.0.0"</span><span class="p">,</span>
    <span class="s2">"bob/package"</span><span class="p">:</span> <span class="p">[</span>
      <span class="s2">"2.0.0 &lt;= v &lt; 3.0.0"</span><span class="p">,</span>
      <span class="s2">"3.4.0 &lt;= v &lt; 3.5.0"</span>
    <span class="p">],</span>
    <span class="s2">"lsjroberts/other"</span><span class="p">:</span> <span class="s2">"1.0.0 &lt;= v &lt; 2.0.0"</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="outdated-and-future-packages">Outdated and future packages</h3>

<p>It should protect me from outdated and future packages.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wool add alice/future
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>To add alice/future I would like to install the following dependencies:

    alice/future  2.0.0 &lt;= v &lt; 3.0.0

But none of the versions in that range work with Node 8.11.0. I recommend upgrading to Node 10.5.0, which is supported.
</code></pre></div></div>

<h3 id="multiple-registries">Multiple registries</h3>

<p>It should allow me to install packages from multiple registries.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// wool.json</span>
<span class="p">{</span>
  <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"lsjroberts/example"</span><span class="p">,</span>
  <span class="c1">// ...</span>
  <span class="s2">"registries"</span><span class="p">:</span> <span class="p">[</span>
    <span class="s2">"https://registry.company.com"</span><span class="p">,</span>
    <span class="s2">"https://registry.wooljs.org"</span>
  <span class="p">],</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wool add company/package
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>To add company/package I would like to install the following dependencies:

    company/package  1.0.0 &lt;= v &lt; 2.0.0 (registry.company.com)
    alice/package    2.2.0 &lt;= v &lt; 3.0.0 (registry.wooljs.org)

Adding a total of 32.6kb to your dependencies

May I install these for you? [Y/n]
</code></pre></div></div>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// wool.json</span>
<span class="p">{</span>
  <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"lsjroberts/example"</span><span class="p">,</span>
  <span class="c1">// ...</span>
  <span class="s2">"registries"</span><span class="p">:</span> <span class="p">[</span>
    <span class="s2">"https://registry.company.com"</span><span class="p">,</span>
    <span class="s2">"https://registry.wooljs.org"</span>
  <span class="p">],</span>
  <span class="s2">"dependencies"</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">"alice/package"</span><span class="p">:</span> <span class="s2">"2.2.0 &lt;= v &lt; 3.0.0"</span><span class="p">,</span>
    <span class="s2">"company/package"</span><span class="p">:</span> <span class="s2">"1.0.0 &lt;= v &lt; 2.0.0"</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// wool-lock.json</span>
<span class="p">{</span>
  <span class="s2">"alice/package"</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">"version"</span><span class="p">:</span> <span class="s2">"2.2.3"</span><span class="p">,</span>
    <span class="s2">"range"</span><span class="p">:</span> <span class="s2">"2.2.0 &lt;= v &lt; 3.0.0"</span><span class="p">,</span>
    <span class="s2">"registry"</span><span class="p">:</span> <span class="s2">"https://registry.wooljs.org"</span>
  <span class="p">},</span>
  <span class="s2">"company/package"</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">"version"</span><span class="p">:</span> <span class="s2">"1.0.2"</span><span class="p">,</span>
    <span class="s2">"range"</span><span class="p">:</span> <span class="s2">"1.0.0 &lt;= v &lt; 2.0.0"</span><span class="p">,</span>
    <span class="s2">"registry"</span><span class="p">:</span> <span class="s2">"https://registry.company.com"</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>It the same package name is found on multiple registries, it would be resolved in priority from first to last registry listed.</p>

<blockquote>
  <p><strong>Note</strong></p>

  <p>It may be useful for a developer to manually specifiy which registry is to be used for a dependency by using the full dependency specification as seen in <code class="highlighter-rouge">wool-lock.json</code>.</p>
</blockquote>

<h3 id="registry-mirrors">Registry mirrors</h3>

<p>It should install from mirrors if a registry is down.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// wool.json</span>
<span class="p">{</span>
  <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"lsjroberts/example"</span><span class="p">,</span>
  <span class="c1">// ...</span>
  <span class="s2">"registries"</span><span class="p">:</span> <span class="p">[</span>
    <span class="s2">"https://registry.company.com"</span><span class="p">,</span>
    <span class="s2">"https://registry.wooljs.org"</span>
  <span class="p">],</span>
  <span class="s2">"mirrors"</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">"https://registry.wooljs.org"</span><span class="p">:</span> <span class="p">[</span>
      <span class="s2">"https://registry.mirror1.org"</span><span class="p">,</span>
      <span class="s2">"https://registry.mirror2.org"</span>
    <span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="workspaces">Workspaces</h3>

<p>It should support flexible workspaces.</p>

<p>Say I want a single repo for all my work, with the <code class="highlighter-rouge">main-core</code> and <code class="highlighter-rouge">main-extra</code> packages sharing a version and <code class="highlighter-rouge">other</code> indendently versioned.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>repo/
├─ workspaces/
│  └─ main/
│  │  ├─ wool.json
│  │  ├─ main-core/
│  │  │  └─ wool.json
│  │  └─ main-extra/
│  │     └─ wool.json
│  └─ other/
│     └─ wool.json
└─ wool.json
</code></pre></div></div>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// wool.json</span>
<span class="p">{</span>
  <span class="s2">"private"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="s2">"registries"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"https://registry.wooljs.org"</span><span class="p">],</span>
  <span class="s2">"nodeVersion"</span><span class="p">:</span> <span class="s2">"10.5.0 &lt;= v &lt; 11.0.0"</span><span class="p">,</span>
  <span class="s2">"workspaces"</span><span class="p">:</span> <span class="p">[</span>
    <span class="s2">"workspaces/main"</span><span class="p">,</span>
    <span class="s2">"workspaces/other"</span>
  <span class="p">]</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Nested workspaces with independent or shared versioning can be freely defined.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// workspaces/main/wool.json</span>
<span class="p">{</span>
  <span class="s2">"private"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="s2">"version"</span><span class="p">:</span> <span class="s2">"1.2.0"</span><span class="p">,</span>
  <span class="s2">"workspaces"</span><span class="p">:</span> <span class="p">[</span>
    <span class="s2">"main-core"</span><span class="p">,</span>
    <span class="s2">"main-extra"</span>
  <span class="p">],</span>
  <span class="s2">"dependencies"</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">"bob/package"</span><span class="p">:</span> <span class="s2">"3.4.0 &lt;= v &lt; 3.5.0"</span><span class="p">,</span>
    <span class="s2">"lsjroberts/other"</span><span class="p">:</span> <span class="s2">"workspace:workspaces/other"</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// workspaces/main/main-core/wool.json</span>
<span class="p">{</span>
  <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"lsjroberts/main-core"</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// workspaces/other/wool.json</span>
<span class="p">{</span>
  <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"lsjroberts/other"</span><span class="p">,</span>
  <span class="s2">"version"</span><span class="p">:</span> <span class="s2">"2.3.0"</span><span class="p">,</span>
  <span class="s2">"dependencies"</span><span class="p">:</span> <span class="p">{}</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wool add alice/package -w main
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>To add alice/package I would like to install the following dependencies in your main workspace:

    alice/package  2.2.0 &lt;= v &lt; 3.0.0

Adding a total of 12.4kb to your main workspace dependencies

May I install these for you? [Y/n]
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wool add alice/package -w main/main-core
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>The workspace main/main-core does not have any dependencies.

Should I try to install alice/package into your main workspace? [Y/n]
</code></pre></div></div>

<h3 id="publishing">Publishing</h3>

<p>It should help me publish with accurate semantic versioning.</p>

<h4 id="minor">Minor</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>It looks like you have added 2 new exports:

    doThing()
    another()

Therefore this should be a minor release:

    1.0.0 =&gt; 1.1.0

Should I update the version, or enter manually? [Y/e/n]
</code></pre></div></div>

<h4 id="major">Major</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>It looks like you have removed 1 export:

    thing()

Therefore this should be a major release:

    1.0.0 =&gt; 2.0.0

Should I update the version, or enter manually? [Y/e/n]
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>It looks like you have changed the signature of an export:

    -thing(foo: number): number
    +thing(foo: string): number

Therefore this should be a major release:

    1.0.0 =&gt; 2.0.0

Should I update the version, or enter manually? [Y/e/n]
</code></pre></div></div>

<h4 id="release">Release</h4>

<p>And tell me where my package was published.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Published lsjroberts/package 1.2.0 to https://registry.wooljs.org
</code></pre></div></div>

<h4 id="workspaces-1">Workspaces</h4>

<p>It should publish all my workspaces.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>It looks like you've added 4 new exports:

    doThing() (main/main-core)
    extraThing() (main/main-extra)
    otherThing() (other)
    anotherThing() (other)

And removed 1 export:

    otherOldThing() (other)

And made non-exported changes:

    src/something.ts (main/main-core)

Therefore main should be a minor release:

    1.2.0 =&gt; 1.3.0
      main-core
      main-extra

And other should be a major release:

    2.3.0 =&gt; 3.0.0

Should I update the version, or enter manually? [Y/e/n]
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Published lsjroberts/main-core 1.3.0 to https://registry.wooljs.org
Published lsjroberts/main-extra 1.3.0 to https://registry.wooljs.org
Published lsjroberts/other 3.0.0 to https://registry.wooljs.org
</code></pre></div></div>

<h3 id="npm">NPM</h3>

<p>It should allow me to benefit from the vast swathes of existing code from the community.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// wool.json</span>
<span class="p">{</span>
  <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"lsjroberts/example"</span><span class="p">,</span>
  <span class="c1">// ...</span>
  <span class="s2">"registries"</span><span class="p">:</span> <span class="p">[</span>
    <span class="s2">"https://registry.wooljs.org"</span><span class="p">,</span>
    <span class="s2">"https://npmjs.org"</span>
  <span class="p">]</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wool add react
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>To add react I would like to install the following dependencies:

    react  16.4.0 &lt;= v &lt; 17.0.0

However this includes the following npm modules:

    react

These will be installed into ./node_modules along with their additional dependencies and not tracked by wool.

You will no longer be able to publish lsjroberts/example to https://registry.wooljs.org.

Are you sure you wish to continue? [Y/n]
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Installed 1 npm package.
</code></pre></div></div>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// wool.json</span>
<span class="p">{</span>
  <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"lsjroberts/example"</span><span class="p">,</span>
  <span class="c1">// ...</span>
  <span class="s2">"registries"</span><span class="p">:</span> <span class="p">[</span>
    <span class="s2">"https://registry.wooljs.org"</span><span class="p">,</span>
    <span class="s2">"https://npmjs.org"</span>
  <span class="p">],</span>
  <span class="s2">"dependencies"</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">"react"</span><span class="p">:</span> <span class="s2">"16.4.0 &lt;= v &lt; 17.0.0"</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// wool-lock.json</span>
<span class="p">{</span>
  <span class="s2">"alice/package"</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">"version"</span><span class="p">:</span> <span class="s2">"2.2.3"</span><span class="p">,</span>
    <span class="s2">"registry"</span><span class="p">:</span> <span class="s2">"https://registry.wooljs.org"</span>
  <span class="p">},</span>
  <span class="s2">"bob/package"</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">"version"</span><span class="p">:</span> <span class="s2">"3.4.0"</span><span class="p">,</span>
    <span class="s2">"registry"</span><span class="p">:</span> <span class="s2">"https://registry.wooljs.org"</span>
  <span class="p">},</span>
  <span class="s2">"lsjroberts/other"</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">"version"</span><span class="p">:</span> <span class="s2">"1.0.13"</span><span class="p">,</span>
    <span class="s2">"registry"</span><span class="p">:</span> <span class="s2">"https://registry.wooljs.org"</span>
  <span class="p">},</span>
  <span class="s2">"react"</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">"version"</span><span class="p">:</span> <span class="s2">"16.4.3"</span><span class="p">,</span>
    <span class="s2">"registry"</span><span class="p">:</span> <span class="s2">"https://npmjs.org"</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="registries" class="part-header">
    Part Two
    <strong>Registries</strong>
</h2>

<p>As stated earlier, development ecosystems should be decentralised. To make this easy and actually practical it should be based on open source packages and baked in to the package manager.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wool init --registry
</code></pre></div></div>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// wool.json</span>
<span class="p">{</span>
  <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"lsjroberts/my-registry"</span><span class="p">,</span>
  <span class="s2">"version"</span><span class="p">:</span> <span class="s2">"1.0.0"</span><span class="p">,</span>
  <span class="s2">"registries"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"https://registry.wooljs.org"</span><span class="p">],</span>
  <span class="s2">"nodeVersion"</span><span class="p">:</span> <span class="s2">"10.5.0 &lt;= v &lt; 11.0.0"</span><span class="p">,</span>
  <span class="s2">"scripts"</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">"start"</span><span class="p">:</span> <span class="s2">"wool-registry start"</span>
  <span class="p">},</span>
  <span class="s2">"dependencies"</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">"wool/registry"</span><span class="p">:</span> <span class="s2">"1.0.0 &lt;= v &lt; 2.0.0"</span><span class="p">,</span>
    <span class="s2">"wool/registry-ui"</span><span class="p">:</span> <span class="s2">"1.0.0 &lt;= v &lt; 2.0.0"</span><span class="p">,</span>
    <span class="s2">"wool/registry-core"</span><span class="p">:</span> <span class="s2">"1.0.0 &lt;= v &lt; 2.0.0"</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wool run start
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Serving lsjroberts/my-registry

    localhost:8080
    0 packages being served
</code></pre></div></div>

<p>You can then publish packages to this registry.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// example/wool.json</span>
<span class="p">{</span>
  <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"lsjroberts/example"</span><span class="p">,</span>
  <span class="s2">"version"</span><span class="p">:</span> <span class="s2">"1.0.0"</span><span class="p">,</span>
  <span class="s2">"registries"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"http://localhost:8080"</span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wool publish
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Published lsjroberts/example 1.0.0 to http://localhost:8080
</code></pre></div></div>

<p>You can configure your registry to work exactly how you want.</p>

<p>Perhaps you want to limit it to just typescript projects to further guarantee semantic versioning. Or reject packages that include dependencies from other registries, like NPM or outside your company.</p>

<p>Perhaps even require all packages be reviewed and approved before they can be published.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// wool.json</span>
<span class="p">{</span>
  <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"lsjroberts/my-registry"</span><span class="p">,</span>
  <span class="c1">// ...</span>
  <span class="s2">"registryRules"</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">"extensions"</span><span class="p">:</span> <span class="p">[</span><span class="s2">".ts"</span><span class="p">]</span>
    <span class="s2">"rejectConflicts"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="s2">"rejectRegistries"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"https://npmjs.org"</span><span class="p">],</span>
    <span class="s2">"requireApproval"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="further" class="part-header">
    Part Three
    <strong>Taking it Further</strong>
</h2>

<p>By creating the registries in this way it leaves open a space for innovation and ideas.</p>

<p>How about a peer-to-peer registry with distributed code? Perhaps utilising the <a href="https://datproject.org/">Dat protocol</a>. Publishing a package would create a <code class="highlighter-rouge">.dat</code> folder on your machine then share its <code class="highlighter-rouge">dat://</code> url with the network to be synchronised and distributed.</p>

<p>It you enjoy a bit of the hype train perhaps you could create a registry on a blockchain. Maintaining popular packages gives you coins you can spend promoting other packages or buying hats for your avatar.</p>

<p>If your business is true enterprise scale and needs to serve thousands of developers across the world you can host your own registry on some big cloud server farm, and mirror any less reliable registries you don’t want to block your team from downtime.</p>

<p>And if your team is smaller and just needs to share a handful of in-house packages you can boot up a registry on the old spare box in the corner.</p>

<hr />

<p>There’s a lot that could be done with this approach, and I feel giving developers and businesses the control and freedom to choose how they build their personal and community ecosystem would only strengthen this rapidly growing sector.</p>

<h2 id="addendum">Addendum</h2>

<p>If you’ve used <a href="http://elm-lang.org/">Elm</a> you may have noticed some similarities in language and concepts. If you haven’t then I’d recommend taking a look to get some of the benefits outlined here.</p>

<p>If you have any ideas or feedback, supportive or critical, please send me a tweet <a href="https://twitter.com/lsjroberts">@lsjroberts</a> and let’s have a chat.</p>

    </article>

    

    <footer class="post-footer">
        <a class="back" href="/">&laquo; read more articles</a>
        <a class="follow" href="https://twitter.com/lsjroberts">follow me @lsjroberts</a>
    </footer>

</div>

            </div>
        </div>

        <footer class="site-footer">
    <a href="https://weheart.github.io/"><img src="/images/heart.png"></a>
</footer>

<!-- Piwik -->
<script type="text/javascript">
  var _paq = _paq || [];
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="//piwik.gelatindesign.co.uk/";
    _paq.push(['setTrackerUrl', u+'piwik.php']);
    _paq.push(['setSiteId', 1]);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<noscript><p><img src="//piwik.gelatindesign.co.uk/piwik.php?idsite=1" style="border:0;" alt="" /></p></noscript>
<!-- End Piwik Code -->

    </body>

</html>
